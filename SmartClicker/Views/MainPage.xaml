<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:SmartClicker.Controls"
             xmlns:converters="clr-namespace:SmartClicker.Converters"
             x:Class="SmartClicker.Views.MainPage"
             BackgroundColor="#1F1F1F">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:IntToStringConverter x:Key="IntToStringConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
        <StackLayout Grid.Row="0" Orientation="Horizontal" Padding="5" Margin="5,0,0,45">
            <controls:HeaderLabel Text="{Binding DynamicData.CurrentX}" />
            <controls:HeaderLabel Text="{Binding DynamicData.CurrentY}" Margin="10,0,0,0" />
            <controls:MediumLabel Text="{Binding DynamicData.StepScoreLabel}" Margin="25,0,0,0" />
            <controls:MediumLabel Text="{Binding DynamicData.LapScore}" Margin="25,0,0,0" />
        </StackLayout>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <HorizontalStackLayout Grid.Row="0" Spacing="15" Margin="20,55,213,0" VerticalOptions="Start" HorizontalOptions="Start">
            <VerticalStackLayout Spacing="5">
                <controls:CustomEntry Placeholder="–°—Ç–∞–Ω–¥–∞—Ä—Ç –∑–∞–¥–µ—Ä–∂–∫–∏" Text="{Binding Input.BlockDelayEntry}"/>
                <controls:CustomEntry Placeholder="–°—Ç–∞–Ω–¥–∞—Ä—Ç –∫–æ–ª-–≤–∞ –Ω–∞–∂–∞—Ç–∏–π" Text="{Binding Input.BlockQuantityEntry}"/>
            </VerticalStackLayout>

            <controls:CustomEntry Placeholder="–†–∞–∑–±—Ä–æ—Å &#x0a; –∑–∞–¥–µ—Ä–∂–∫–∏" Text="{Binding Input.RandomOfDelay}"/>

            <VerticalStackLayout Spacing="5">
                <controls:CustomSwitchV2 IsToggled="{Binding Settings.OnCoordinates}"
                    OnText="–ù–µ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º"
                    OffText="–ü–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º"
                    OnBackgroundColor="#1B1B1B"
                    OffBackgroundColor="#1B1B1B"
                    OnTextColor="#FFD2B6"
                    OffTextColor="#D2FFDE"/>
                <controls:CustomSwitchV2 IsToggled="{Binding Settings.BackMove}"
                    OnText="–í–æ–∑–≤—Ä–∞—â–∞—Ç—å"
                    OffText="–ù–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å"
                    OnBackgroundColor="#1B1B1B"
                    OffBackgroundColor="#1B1B1B"
                    OnTextColor="#FFD2B6"
                    OffTextColor="#D2FFDE"/>
            </VerticalStackLayout>
        </HorizontalStackLayout>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å –±–ª–æ–∫–∞–º–∏ –∫–ª–∏–∫–æ–≤ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout x:Name="EntriesStackLayout" Padding="15,0" Spacing="15">
                <!-- CollectionView —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ ClickBlocks -->
                <CollectionView ItemsSource="{Binding ClickBlocks}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <StackLayout>
                                <HorizontalStackLayout Spacing="10" Padding="5">
                                    <controls:CustomSwitchV2 IsToggled="{Binding IsRightClick}"
                                                OnText="–ü–ö–ú"
                                                OffText="–õ–ö–ú"
                                                OnBackgroundColor="#1B1B1B"
                                                OffBackgroundColor="#1B1B1B"
                                                OnTextColor="#FFD2B6"
                                                OffTextColor="#D2FFDE"/>

                                    <controls:CustomSwitchV2 IsToggled="{Binding IsClamping}"
                                                OnText="–ó–∞–∂–∞—Ç—å"
                                                OffText="–ù–∞–∂–∞—Ç—å"
                                                OnBackgroundColor="#1B1B1B"
                                                OffBackgroundColor="#1B1B1B"
                                                OnTextColor="#FFD2B6"
                                                OffTextColor="#D2FFDE"/>

                                    <VerticalStackLayout>
                                        <controls:CustomEntry Placeholder="–¶–µ–ª–µ–≤–∞—è X" Text="{Binding TargetX}" />
                                        <controls:CustomEntry Placeholder="–¶–µ–ª–µ–≤–∞—è Y" Text="{Binding TargetY}" />
                                    </VerticalStackLayout>

                                    <VerticalStackLayout>
                                        <controls:CustomEntry Placeholder="–ó–∞–¥–µ—Ä–∂–∫–∞" Text="{Binding ClickInterval}" />
                                        <controls:CustomEntry Placeholder="–ö–æ–ª-–≤–æ –Ω–∞–∂–∞—Ç–∏–π" Text="{Binding StepScore}" />
                                    </VerticalStackLayout>

                                    <controls:CustomEntry Placeholder="–†–∞–∑–±—Ä–æ—Å &#x0a; –∑–∞–¥–µ—Ä–∂–∫–∏" Text="{Binding RandomOfDelay}"/>
                                </HorizontalStackLayout>
                                <VerticalStackLayout Margin="6,0,0,10" HorizontalOptions="Start">
                                    <controls:CustomEntry MaximumWidthRequest="377" Placeholder="–ó–∞–º–µ—Ç–∫–∞"
                                                          Text="{Binding Note}"/>
                                </VerticalStackLayout>
                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <StackLayout Grid.Row="1" Orientation="Vertical" Padding="0" Spacing="10" Margin="0,0,15,0" HorizontalOptions="End">
            <controls:CustomEntry Placeholder="–ö–æ–ª-–≤–æ –±–ª–æ–∫–æ–≤" Text="{Binding Input.BlockCountEntry}" />
            <HorizontalStackLayout HorizontalOptions="Center">
                <controls:CustomButton Text="–î–æ–±–∞–≤–∏—Ç—åüß©" Command="{Binding AddBlocksCommand}" />
                <controls:CustomButton Text="–∑–∞–º–µ–Ω–∏—Ç—å‚ôªÔ∏è" Command="{Binding ReAddBlocksCommand}" />
            </HorizontalStackLayout>
            <controls:CustomEntry Placeholder="–ö–æ–ª-–≤–æ –∫—Ä—É–≥–æ–≤" Text="{Binding Input.BlockLapEntry}" Margin="0,5,0,0" />
            <HorizontalStackLayout Spacing="7">
                <controls:CustomEntry Placeholder="–ù–∞—á–∞—Ç—å —á–µ—Ä–µ–∑" Text="{Binding Input.StartOffsetEntry}" />
                <Picker x:Name="UnitPicker" TextColor="WhiteSmoke"
                        SelectedItem="{Binding Settings.SelectedUnit, Mode=TwoWay}">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>–ú–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã</x:String>
                            <x:String>–°–µ–∫—É–Ω–¥—ã</x:String>
                            <x:String>–ú–∏–Ω—É—Ç—ã</x:String>
                            <x:String>–ß–∞—Å—ã</x:String>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>
            </HorizontalStackLayout>
        </StackLayout>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <StackLayout Grid.Row="2" Orientation="Vertical" Padding="10" Spacing="10">
            <Label HorizontalOptions="End" BackgroundColor="#2C2C2C" FontSize="Micro" TextColor="White" 
                Text= "–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é (Ctrl+X)  |  –î—Ä–æ–±–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ‚Äú,‚Äù" />

            <HorizontalStackLayout Spacing="5" HorizontalOptions="End">

                <HorizontalStackLayout Spacing="10" HorizontalOptions="Start" Margin="0,0,110,0">
                    <controls:CustomButton Text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç üíæ" Command="{Binding SavePresetCommand}" />

                    <VerticalStackLayout Spacing="3">
                        <Picker ItemsSource="{Binding PresetFiles}"
                                SelectedItem="{Binding SelectedPresetFile}"
                                MaximumWidthRequest="175"
                                HeightRequest="30"/>
                        <controls:CustomButton Text="–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ—Å–µ—Ç üíæ" Command="{Binding LoadPresetCommand}" />
                    </VerticalStackLayout>
                </HorizontalStackLayout>


                <controls:CustomSwitchV2 IsToggled="{Binding IsPaused, Mode=TwoWay}"  Margin="0,0,25,0"
                        OnText="–ù–∞ –ø–∞—É–∑–µ‚è∏Ô∏è&#x0a;   (Ctrl+T)"
                        OffText="–ü–∞—É–∑–∞‚èØÔ∏è&#x0a; (Ctrl+T)"
                        OnBackgroundColor="#7CA37F"
                        OffBackgroundColor="#5CA35F"
                        OnTextColor="White"
                        OffTextColor="#1F1F1F"/>

                <controls:CustomButton Text="–ó–∞–≤–µ—Ä—à–∏—Ç—å‚ùå&#x0a;    (Ctrl+R)" Command="{Binding EndCommand}"/>
                <controls:CustomButton Text="–ó–∞–ø—É—Å—Ç–∏—Ç—åüî•&#x0a;   (Ctrl+E)" Command="{Binding StartCommand}" />
            </HorizontalStackLayout>
        </StackLayout>
    </Grid>
</ContentPage>
